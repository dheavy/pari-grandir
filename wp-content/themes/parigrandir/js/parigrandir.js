// Generated by CoffeeScript 1.4.0
(function() {

  jQuery(function() {
    /*
    	Language switch mechanism
    */

    var $flyOutParents, $flyoutContainer, $images, $langSwitch, $slideshowContainer, index, setLang, showImage, tick, timer;
    $langSwitch = $('.lang-switch');
    $langSwitch.click(function(e) {
      $.ajax({
        url: '/wp-admin/admin-ajax.php',
        data: {
          action: 'switch',
          lang: e.target.getAttribute('data-lang')
        },
        complete: function(xhr) {
          var lang;
          if ($.parseJSON(xhr.responseText).success != null) {
            lang = $.parseJSON(xhr.responseText).success;
            return setLang(lang);
          }
        }
      });
      return false;
    });
    /*
    	Display proper language
    */

    setLang = function(lang) {
      if (lang === 'fr') {
        $('.en').css('display', 'none');
        $('.fr').css('display', 'block');
        $('.to-en', $langSwitch).removeClass('selected');
        return $('.to-fr', $langSwitch).addClass('selected');
      } else {
        $('.fr').css('display', 'none');
        $('.en').css('display', 'block');
        $('.to-fr', $langSwitch).removeClass('selected');
        return $('.to-en', $langSwitch).addClass('selected');
      }
    };
    /*
    	Enable fly-out menus in top nav.
    */

    $flyOutParents = $('.has-flyout-menu');
    $flyoutContainer = $('#flyout-container');
    $flyOutParents.each(function(i, elm) {
      var $flyoutMenu;
      if (elm.getAttribute('data-submenu') !== null) {
        $flyoutMenu = $('.' + elm.getAttribute('data-submenu'));
      }
      $flyoutContainer.append($flyoutMenu);
      elm.onmouseover = function(e) {
        $flyoutMenu.show();
        return $(this).addClass('selected');
      };
      return $flyoutMenu.mouseleave(function(e) {
        $flyoutMenu.hide();
        return $(elm).removeClass('selected');
      });
    });
    /*
    	Set default language.
    */

    setLang($('meta[name="current_lang"]').attr('content'));
    /*
    	Show content.
    */

    $('body').animate({
      'opacity': 1
    }, 500);
    /*
    	Homepage: build and show gallery.
    */

    $.fn.exists = function() {
      return this.length !== 0;
    };
    $images = $('#page-accueil .welcome img');
    if ($images.exists()) {
      $slideshowContainer = $('.slideshow');
      $images.each(function(i, img) {
        $(img).addClass('slide');
        return $slideshowContainer.append(img);
      });
      timer = 3000;
      index = 0;
      showImage = function(index) {
        return $images.each(function(i, img) {
          if (index === i) {
            return $(img).fadeIn(1000);
          } else {
            return $(img).fadeOut(1000);
          }
        });
      };
      return tick = setInterval(function() {
        showImage(index);
        if (index < $images.length - 1) {
          return index++;
        } else {
          return index = 0;
        }
      }, timer);
    }
  });

}).call(this);
